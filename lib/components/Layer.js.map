{"version":3,"sources":["../../src/components/Layer.js"],"names":["Layer","props","context","layerStore","id","children","to","use","defaultArgs","defaultShow","register","newProps","needUpdate","toString","length","i","equals","JSON","stringify","updateFn","elementType","LayerMountPoint","Component","propTypes","PropTypes","array","defaultProps","contextTypes","object"],"mappings":"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","file":"Layer.js","sourcesContent":["import React, { Component, createElement} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { isPrimitiveType } from './../common';\r\nimport LayerStore from './../LayerStore';\r\nimport LayerMountPoint from './LayerMountPoint';\r\n\r\nexport default class Layer extends Component {\r\n\r\n  layerStore: LayerStore;\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n    this.layerStore = context.layerStore;\r\n  }\r\n\r\n  componentWillMount() {\r\n    const { layerStore } = this.context;\r\n    const { id, children, to, use, defaultArgs, defaultShow } = this.props;\r\n    layerStore.register(id, children, to, null, use, defaultArgs, defaultShow);\r\n  }\r\n\r\n  shouldComponentUpdate(newProps) {\r\n    const { children, id, to, use } = this.props;\r\n    const { layerStore } = this.context;\r\n    let needUpdate = false;\r\n    if (id !== newProps.id || to !== newProps.to) {\r\n      needUpdate = true;\r\n    }\r\n    else if (children.toString() !== newProps.children.toString()) {\r\n      needUpdate = true;\r\n    }\r\n    else if (use) {\r\n      if (use.length !== newProps.use.length) {\r\n        needUpdate = true;\r\n      } else {\r\n        let i = use.length;\r\n        while (i--) {\r\n          if (isPrimitiveType(use[i]) && isPrimitiveType(newProps.use[i])) {\r\n            if (use[i] !== newProps.use[i]) {\r\n              needUpdate = true\r\n            }\r\n          }\r\n          else if (typeof use[i].equals === 'function' && typeof newProps.use[i].equals === 'function') {\r\n            if (!use[i].equals(newProps.use[i])) { // fast equality check for immutable-js && mori\r\n              needUpdate = true;\r\n            }\r\n          }\r\n          else if (JSON.stringify(use[i]) !== JSON.stringify(newProps.use[i])) {\r\n            needUpdate = true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (needUpdate) {\r\n      layerStore.updateFn(newProps.id, newProps.children, newProps.to, null, newProps.use, newProps.defaultArgs, newProps.defaultShow);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.layerStore = null;\r\n  }\r\n\r\n  render() {\r\n    const { id, to, elementType } = this.props;\r\n    if (!to) {\r\n      return createElement(LayerMountPoint, { id });\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\nLayer.propTypes = {\r\n  use: PropTypes.array\r\n};\r\n\r\nLayer.defaultProps = {\r\n  elementType: 'span'\r\n};\r\n\r\nLayer.contextTypes = {\r\n  layerStore: PropTypes.object\r\n};\r\n"]}