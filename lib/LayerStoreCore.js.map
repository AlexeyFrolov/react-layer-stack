{"version":3,"sources":["../src/LayerStoreCore.js"],"names":["LayerStoreCore","store","stack","layers","getLayer","bind","getStack","show","hide","update","register","updateFn","unregister","isActive","getIndex","getLayersForMountPoint","id","mountPointId","Object","keys","filter","layerFn","groups","use","defaultArgs","defaultShow","reset","layer","fn","args","length","indexOf","splice"],"mappings":"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","file":"LayerStoreCore.js","sourcesContent":["import type { ID, LayerFn, Layer, Store, LayerStack, ILayerStore } from './types'\r\n\r\nexport default class LayerStoreCore {\r\n\r\n  store: Store;\r\n\r\n  constructor () {\r\n    this.store = {\r\n      stack: [],\r\n      layers: {},\r\n    };\r\n\r\n    this.getLayer = this.getLayer.bind(this);\r\n    this.getStack = this.getStack.bind(this);\r\n    this.show = this.show.bind(this);\r\n    this.hide = this.hide.bind(this);\r\n    this.update = this.update.bind(this);\r\n    this.register = this.register.bind(this);\r\n    this.updateFn = this.updateFn.bind(this);\r\n    this.unregister = this.unregister.bind(this);\r\n    this.isActive = this.isActive.bind(this);\r\n    this.getIndex = this.getIndex.bind(this);\r\n    this.getLayersForMountPoint = this.getLayersForMountPoint.bind(this);\r\n  }\r\n\r\n  getLayer(id: ID): Layer {\r\n    return this.store.layers[id];\r\n  }\r\n\r\n  getLayersForMountPoint(mountPointId: ID) {\r\n    const { layers } = this.store;\r\n    return Object.keys(layers).filter(id => layers[id].mountPointId === mountPointId)\r\n  }\r\n\r\n  getStack(): LayerStack {\r\n    return this.store.stack;\r\n  }\r\n\r\n  register (id: ID, layerFn: LayerFn, mountPointId: ID = null,\r\n            groups: Array<ID> = [], use: Array, defaultArgs: Array = [],\r\n            defaultShow: Boolean) {\r\n    this.store.layers[id] = { layerFn, groups, mountPointId, defaultArgs, defaultShow, use };\r\n    this.reset(id);\r\n  }\r\n\r\n  updateFn (id: ID, layerFn: LayerFn, mountPointId: ID = null,\r\n            groups: Array<ID> = [], use: Array, defaultArgs: Array = [],\r\n            defaultShow: Boolean) {\r\n    const layer = this.getLayer(id);\r\n    layer.fn = layerFn;\r\n    layer.use = use;\r\n    layer.mountPointId = mountPointId;\r\n    layer.groups = groups;\r\n    layer.defaultArgs = defaultArgs;\r\n    layer.defaultShow = defaultShow;\r\n  }\r\n\r\n  reset(id: ID) {\r\n    const layer = this.store.layers[id];\r\n    layer.args = layer.defaultArgs;\r\n    if (layer.defaultShow) {\r\n      this.show(id);\r\n    }\r\n  }\r\n\r\n  unregister(id: ID) {\r\n    delete this.store.layers[id];\r\n  }\r\n\r\n  update(id: ID, args: Array = []) {\r\n    if (args.length) {\r\n      this.store.layers[id].args = args;\r\n    } else {\r\n      this.store.layers[id].args = this.store.layers[id].defaultArgs;\r\n    }\r\n  }\r\n\r\n  show (id: ID, args: Array) {\r\n    const { stack } = this.store;\r\n    this.update(id, args);\r\n    if ( id !== stack[stack.length - 1] ) {\r\n      this.hide(id);\r\n      this.store.stack = [...stack, id];\r\n    }\r\n  }\r\n\r\n  hide (id: ID) {\r\n    const stack = [...this.store.stack];\r\n    if (-1 !== stack.indexOf(id)) {\r\n      stack.splice(stack.indexOf(id), 1);\r\n      this.store.stack = stack;\r\n    }\r\n  }\r\n\r\n  getIndex(id: ID) {\r\n    return this.store.stack.indexOf(id);\r\n  }\r\n\r\n  isActive(id: ID) {\r\n    return this.store.stack.indexOf(id) !== -1;\r\n  }\r\n}\r\n"]}