{"version":3,"sources":["../src/LayerStoreCore.js"],"names":["LayerStoreCore","store","stack","layers","getLayer","bind","getStack","show","hide","update","register","updateFn","unregister","isActive","getIndex","getLayersForMountPoint","id","mountPointId","Object","keys","filter","layerFn","defaultArgs","defaultShow","reset","layer","fn","args","length","indexOf","splice"],"mappings":";;AAEqBA,c;;;;AAInB,4BAAe;AACb,SAAKC,KAAL,GAAa;AACXC,aAAO,EADI;AAEXC,cAAQ,EAFG,EAAb;;;AAKA,SAAKC,QAAL,GAAgB,KAAKA,QAAL,CAAcC,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKC,QAAL,GAAgB,KAAKA,QAAL,CAAcD,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKE,IAAL,GAAY,KAAKA,IAAL,CAAUF,IAAV,CAAe,IAAf,CAAZ;AACA,SAAKG,IAAL,GAAY,KAAKA,IAAL,CAAUH,IAAV,CAAe,IAAf,CAAZ;AACA,SAAKI,MAAL,GAAc,KAAKA,MAAL,CAAYJ,IAAZ,CAAiB,IAAjB,CAAd;AACA,SAAKK,QAAL,GAAgB,KAAKA,QAAL,CAAcL,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKM,QAAL,GAAgB,KAAKA,QAAL,CAAcN,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKO,UAAL,GAAkB,KAAKA,UAAL,CAAgBP,IAAhB,CAAqB,IAArB,CAAlB;AACA,SAAKQ,QAAL,GAAgB,KAAKA,QAAL,CAAcR,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKS,QAAL,GAAgB,KAAKA,QAAL,CAAcT,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKU,sBAAL,GAA8B,KAAKA,sBAAL,CAA4BV,IAA5B,CAAiC,IAAjC,CAA9B;AACD,G;;AAEQW,M,EAAe;AACtB,aAAO,KAAKf,KAAL,CAAWE,MAAX,CAAkBa,EAAlB,CAAP;AACD,K;;AAEsBC,gB,EAAkB;AAC/Bd,YAD+B,GACpB,KAAKF,KADe,CAC/BE,MAD+B;AAEvC,aAAOe,OAAOC,IAAP,CAAYhB,MAAZ,EAAoBiB,MAApB,CAA2B,sBAAMjB,OAAOa,EAAP,EAAWC,YAAX,KAA4BA,YAAlC,EAA3B,CAAP;AACD,K;;AAEsB;AACrB,aAAO,KAAKhB,KAAL,CAAWC,KAAlB;AACD,K;;AAESc,M;AACAK,W;;;AAGsB,SAFtBJ,YAEsB,uEAFH,IAEG,KADtBK,WACsB,uEADD,EACC,KAAtBC,WAAsB;AAC9B,WAAKtB,KAAL,CAAWE,MAAX,CAAkBa,EAAlB,IAAwB,EAAEK,gBAAF,EAAWJ,0BAAX,EAAyBK,wBAAzB,EAAsCC,wBAAtC,EAAxB;AACA,WAAKC,KAAL,CAAWR,EAAX;AACD,K;;AAESA,M;AACAK,W;;;AAGsB,SAFtBJ,YAEsB,uEAFH,IAEG,KADtBK,WACsB,uEADD,EACC,KAAtBC,WAAsB;AAC9B,UAAME,QAAQ,KAAKrB,QAAL,CAAcY,EAAd,CAAd;AACAS,YAAMC,EAAN,GAAWL,OAAX;AACAI,YAAMR,YAAN,GAAqBA,YAArB;AACAQ,YAAMH,WAAN,GAAoBA,WAApB;AACAG,YAAMF,WAAN,GAAoBA,WAApB;AACD,K;;AAEKP,M,EAAQ;AACZ,UAAMS,QAAQ,KAAKxB,KAAL,CAAWE,MAAX,CAAkBa,EAAlB,CAAd;AACAS,YAAME,IAAN,GAAaF,MAAMH,WAAnB;AACA,UAAIG,MAAMF,WAAV,EAAuB;AACrB,aAAKhB,IAAL,CAAUS,EAAV;AACD;AACF,K;;AAEUA,M,EAAQ;AACjB,aAAO,KAAKf,KAAL,CAAWE,MAAX,CAAkBa,EAAlB,CAAP;AACD,K;;AAEMA,M,EAA0B,KAAlBW,IAAkB,uEAAJ,EAAI;AAC/B,WAAK1B,KAAL,CAAWE,MAAX,CAAkBa,EAAlB,EAAsBW,IAAtB,GAA6BA,IAA7B;AACD,K;;AAEKX,M,EAAQW,I,EAAa;AACjBzB,WADiB,GACP,KAAKD,KADE,CACjBC,KADiB;AAEzB,UAAGyB,QAAQA,KAAKC,MAAhB,EAAwB;AACtB,aAAKnB,MAAL,CAAYO,EAAZ,EAAgBW,IAAhB;AACD;AACD,UAAKX,OAAOd,MAAMA,MAAM0B,MAAN,GAAe,CAArB,CAAZ,EAAsC;AACpC,aAAKpB,IAAL,CAAUQ,EAAV;AACA,aAAKf,KAAL,CAAWC,KAAX,gCAAuBA,KAAvB,IAA8Bc,EAA9B;AACD;AACF,K;;AAEKA,M,EAAQ;AACZ,UAAMd,qCAAY,KAAKD,KAAL,CAAWC,KAAvB,EAAN;AACA,UAAI,CAAC,CAAD,KAAOA,MAAM2B,OAAN,CAAcb,EAAd,CAAX,EAA8B;AAC5Bd,cAAM4B,MAAN,CAAa5B,MAAM2B,OAAN,CAAcb,EAAd,CAAb,EAAgC,CAAhC;AACA,aAAKf,KAAL,CAAWC,KAAX,GAAmBA,KAAnB;AACD;AACF,K;;AAEQc,M,EAAQ;AACf,aAAO,KAAKf,KAAL,CAAWC,KAAX,CAAiB2B,OAAjB,CAAyBb,EAAzB,CAAP;AACD,K;;AAEQA,M,EAAQ;AACf,aAAO,KAAKf,KAAL,CAAWC,KAAX,CAAiB2B,OAAjB,CAAyBb,EAAzB,MAAiC,CAAC,CAAzC;AACD,K,iDAlGkBhB,c","file":"LayerStoreCore.js","sourcesContent":["import type { ID, LayerFn, Layer, Store, LayerStack, ILayerStore } from './types'\n\nexport default class LayerStoreCore {\n\n  store: Store;\n\n  constructor () {\n    this.store = {\n      stack: [],\n      layers: {},\n    };\n\n    this.getLayer = this.getLayer.bind(this);\n    this.getStack = this.getStack.bind(this);\n    this.show = this.show.bind(this);\n    this.hide = this.hide.bind(this);\n    this.update = this.update.bind(this);\n    this.register = this.register.bind(this);\n    this.updateFn = this.updateFn.bind(this);\n    this.unregister = this.unregister.bind(this);\n    this.isActive = this.isActive.bind(this);\n    this.getIndex = this.getIndex.bind(this);\n    this.getLayersForMountPoint = this.getLayersForMountPoint.bind(this);\n  }\n\n  getLayer(id: ID): Layer {\n    return this.store.layers[id];\n  }\n\n  getLayersForMountPoint(mountPointId: ID) {\n    const { layers } = this.store;\n    return Object.keys(layers).filter(id => layers[id].mountPointId === mountPointId)\n  }\n\n  getStack(): LayerStack {\n    return this.store.stack;\n  }\n\n  register (id: ID,\n            layerFn: LayerFn,\n            mountPointId: ID = null,\n            defaultArgs: Array = [],\n            defaultShow: Boolean) {\n    this.store.layers[id] = { layerFn, mountPointId, defaultArgs, defaultShow };\n    this.reset(id);\n  }\n\n  updateFn (id: ID,\n            layerFn: LayerFn,\n            mountPointId: ID = null,\n            defaultArgs: Array = [],\n            defaultShow: Boolean) {\n    const layer = this.getLayer(id);\n    layer.fn = layerFn;\n    layer.mountPointId = mountPointId;\n    layer.defaultArgs = defaultArgs;\n    layer.defaultShow = defaultShow;\n  }\n\n  reset(id: ID) {\n    const layer = this.store.layers[id];\n    layer.args = layer.defaultArgs;\n    if (layer.defaultShow) {\n      this.show(id);\n    }\n  }\n\n  unregister(id: ID) {\n    delete this.store.layers[id];\n  }\n\n  update(id: ID, args: Array = []) {\n    this.store.layers[id].args = args;\n  }\n\n  show (id: ID, args: Array) {\n    const { stack } = this.store;\n    if(args && args.length) {\n      this.update(id, args);\n    }\n    if ( id !== stack[stack.length - 1] ) {\n      this.hide(id);\n      this.store.stack = [...stack, id];\n    }\n  }\n\n  hide (id: ID) {\n    const stack = [...this.store.stack];\n    if (-1 !== stack.indexOf(id)) {\n      stack.splice(stack.indexOf(id), 1);\n      this.store.stack = stack;\n    }\n  }\n\n  getIndex(id: ID) {\n    return this.store.stack.indexOf(id);\n  }\n\n  isActive(id: ID) {\n    return this.store.stack.indexOf(id) !== -1;\n  }\n}\n"]}