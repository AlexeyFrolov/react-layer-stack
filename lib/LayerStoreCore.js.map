{"version":3,"sources":["../src/LayerStoreCore.js"],"names":["LayerStoreCore","store","stack","layers","getLayer","bind","getStack","show","hide","register","updateFn","unregister","isActive","getIndex","id","layerFn","mountPointId","groups","use","defaultArgs","defaultShow","reset","layer","fn","args","length","setArgs","indexOf","splice"],"mappings":"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","file":"LayerStoreCore.js","sourcesContent":["import type { ID, LayerFn, Layer, Store, LayerStack, ILayerStore } from './types'\n\nexport default class LayerStoreCore {\n\n  store: Store;\n\n  constructor () {\n    this.store = {\n      stack: [],\n      layers: {},\n    };\n\n    this.getLayer = this.getLayer.bind(this);\n    this.getStack = this.getStack.bind(this);\n    this.show = this.show.bind(this);\n    this.hide = this.hide.bind(this);\n    this.register = this.register.bind(this);\n    this.updateFn = this.updateFn.bind(this);\n    this.unregister = this.unregister.bind(this);\n    this.isActive = this.isActive.bind(this);\n    this.getIndex = this.getIndex.bind(this);\n  }\n\n  getLayer(id: ID): Layer {\n    return this.store.layers[id];\n  }\n\n  getStack(): LayerStack {\n    return this.store.stack;\n  }\n\n  register (id: ID, layerFn: LayerFn, mountPointId: ID = null,\n            groups: Array<ID> = [], use: Array, defaultArgs: Array = [],\n            defaultShow: Boolean) {\n    this.store.layers[id] = { layerFn, groups, mountPointId, defaultArgs, defaultShow, use };\n    this.reset(id);\n  }\n\n  updateFn (id: ID, layerFn: LayerFn, mountPointId: ID = null,\n            groups: Array<ID> = [], use: Array, defaultArgs: Array = [],\n            defaultShow: Boolean) {\n    const layer = this.getLayer(id);\n    layer.fn = layerFn;\n    layer.use = use;\n    layer.mountPointId = mountPointId;\n    layer.groups = groups;\n    layer.defaultArgs = defaultArgs;\n    layer.defaultShow = defaultShow;\n  }\n\n  reset(id: ID) {\n    const layer = this.store.layers[id];\n    layer.args = layer.defaultArgs;\n    if (layer.defaultShow) {\n      this.show(id);\n    }\n  }\n\n  unregister(id: ID) {\n    delete this.store.layers[id];\n  }\n\n  setArgs(id: ID, args: Array = []) {\n    if (args.length) {\n      this.store.layers[id].args = args;\n    } else {\n      this.store.layers[id].args = this.store.layers[id].defaultArgs;\n    }\n  }\n\n  show (id: ID, args: Array) {\n    const { stack } = this.store;\n    this.setArgs(id, args);\n    if ( id !== stack[stack.length - 1] ) {\n      this.hide(id);\n      this.store.stack = [...stack, id];\n    }\n  }\n\n  hide (id: ID) {\n    const stack = [...this.store.stack];\n    if (-1 !== stack.indexOf(id)) {\n      stack.splice(stack.indexOf(id), 1);\n      this.store.stack = stack;\n    }\n  }\n\n  getIndex(id: ID) {\n    return this.store.stack.indexOf(id);\n  }\n\n  isActive(id: ID) {\n    return this.store.stack.indexOf(id) !== -1;\n  }\n}\n"]}