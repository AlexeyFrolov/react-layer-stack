{"version":3,"sources":["../src/components.js"],"names":["LayerStackMountPoint","namespace","store","dispatch","renderFn","views","displaying","show","hide","hideAll","length","map","id","index","showOnlyMe","args","hideMe","showMe","Layer","createClass","componentWillMount","props","register","children","showInitially","defaultArgs","shouldComponentUpdate","newProps","use","needUpdate","toString","i","JSON","stringify","componentWillUnmount","render","LayerToggle","isActive","indexOf"],"mappings":"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","file":"components.js","sourcesContent":["import React, { PropTypes } from 'react'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\n\nimport { ACTIONS } from './reducer'\n\nexport const LayerStackMountPoint = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({ renderFn, views, displaying, show, hide, hideAll}) => { // from store\n  return (\n    <div> { renderFn ? renderFn({views, displaying, show, hide, hideAll})\n      : (displaying.length ? displaying.map (\n      (id, index) =>\n          <div key={id}>\n            {\n              views[id].renderFn({ // TODO: check that renderFn is a function\n                index, id, show, hide, hideAll, displaying, views,\n                showOnlyMe: (...args) => hideAll() || show(id, ...args), // TODO: improve\n                hideMe: () => hide(id),\n                showMe: (...args) => show(id, ...args) // sometimes you may want to change args of the current layer\n              }, ...views[id].args)\n            }\n          </div>\n    )\n      : <noscript />) }\n    </div>\n  )\n});\n\nexport const Layer = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)((React.createClass({\n  componentWillMount() {\n    this.props.register(this.props.id, this.props.children);\n    if (this.props.showInitially) {\n      this.props.show(this.props.id, this.props.defaultArgs || [])\n    }\n  },\n  shouldComponentUpdate(newProps) {\n    const { use, children, register, id } = this.props;\n    let needUpdate = false;\n    if (id !== newProps.id) {\n      needUpdate = true;\n    }\n    else if (children.toString() !== newProps.children.toString()) {\n      needUpdate = true;\n    }\n    else if (use) {\n      if (use.length !== newProps.use.length) {\n        needUpdate = true;\n      } else {\n        let i = use.length;\n        while (i--) {\n          if (JSON.stringify(use[i]) !== JSON.stringify(newProps.use[i])) {\n            needUpdate = true;\n          }\n        }\n      }\n    }\n\n    if (needUpdate) {\n      register(newProps.id, newProps.children);\n      return true;\n    }\n    return false;\n  },\n\n  componentWillUnmount() {\n    // TODO: garbage collection\n    // this.props.unregister(this.props.id)\n  },\n\n  render() {\n    return <noscript />\n  }\n})));\n\nexport const LayerToggle = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({ children, id, // from props\n  displaying, show, hide, hideAll, views // from store\n}) => {\n  return children({\n    show, hide, hideAll, displaying, views,\n    isActive: displaying.indexOf(id) !== -1,\n    showMe: (...args) => show(id, ...args),\n    showOnlyMe: (...args) => hideAll() || show(id, ...args),\n    hideMe: () => hide(id),\n  });\n});"]}