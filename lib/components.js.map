{"version":3,"sources":["../src/components.js"],"names":["LayerStackMountPoint","namespace","store","dispatch","mountPointId","id","mountPointArgs","args","renderFn","views","displaying","show","hide","hideAll","length","map","index","view","showOnlyMe","Error","Layer","createClass","propTypes","use","array","componentWillMount","props","register","children","showInitially","initialArgs","setArgs","shouldComponentUpdate","newProps","needUpdate","toString","i","JSON","stringify","componentWillUnmount","render","LayerToggle","isActive","indexOf"],"mappings":"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","file":"components.js","sourcesContent":["import React, { PropTypes } from 'react'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\n\nimport { ACTIONS } from './reducer'\n\nexport const LayerStackMountPoint = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({\n  id: mountPointId, args: mountPointArgs, // from props\n  renderFn, views, displaying, show, hide, hideAll // from store\n}) => {\n  return (\n    <div> { renderFn ? renderFn({views, displaying, show, hide, hideAll, mountPointId, mountPointArgs}) // it's possible to provide alternative renderFn for the MountPoint\n      : (displaying.length ? displaying.map ((id, index) => // if no alternative renderFn provided we'll use the default one\n        <div key={id}>\n          {(() => {\n            const view = views[id];\n            if (view && view.renderFn && view.mountPointId === mountPointId) {\n              return view.renderFn({\n                index, id, hideAll, displaying, views, mountPointArgs, // seems like there is no valid use-case mountPointId in the Layer render function\n                showOnlyMe: (...args) => hideAll() || show(id, ...args), // TODO: think about improvement\n                hide: () => hide(id), // intention here is to hide ID's management from Layer and let app developer manage these IDs independently\n                // which will give an ability to write general-purpose Layers and share them b/w projects\n                show: (...args) => show(id, ...args) // sometimes you may want to change args of the current layer\n              }, ...view.args)\n            }\n            if (typeof view === 'undefined' || typeof view.renderFn === 'undefined') {\n              throw new Error(`\nIt seems like you're using LayerToggle with id=\"${ id }\" but corresponding Layer isn't declared in the current Components tree.\nMake sure that Layer with id=\"${ id }\" is rendered into the current tree.\n`)\n            }})()}\n        </div>) : <noscript />)}\n    </div>\n  )\n});\n\nexport const Layer = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)((React.createClass({\n  propTypes: {\n    use: PropTypes.array\n  },\n\n  componentWillMount() {\n    this.props.register(this.props.id, this.props.children, this.props.mountPointId);\n    if (this.props.showInitially) {\n      this.props.show(this.props.id, ...(this.props.initialArgs || []))\n    } else {\n      this.props.setArgs(this.props.id, ...(this.props.initialArgs || []))\n    }\n  },\n  shouldComponentUpdate(newProps) {\n    const { children, register, id, mountPointId, use } = this.props;\n    let needUpdate = false;\n    if (id !== newProps.id || mountPointId !== newProps.mountPointId) {\n      needUpdate = true;\n    }\n    else if (children.toString() !== newProps.children.toString()) {\n      needUpdate = true;\n    }\n    else if (use) {\n      if (use.length !== newProps.use.length) {\n        needUpdate = true;\n      } else {\n        let i = use.length;\n        while (i--) {\n          if (JSON.stringify(use[i]) !== JSON.stringify(newProps.use[i])) {\n            needUpdate = true;\n          }\n        }\n      }\n    }\n\n    if (needUpdate) {\n      register(newProps.id, newProps.children, newProps.mountPointId);\n      return true;\n    }\n    return false;\n  },\n\n  componentWillUnmount() {\n    // TODO: garbage collection\n    // this.props.unregister(this.props.id)\n  },\n\n  render() {\n    return <noscript />\n  }\n})));\n\nexport const LayerToggle = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({\n  children, id, // from props\n  displaying, show, hide, hideAll, views // from store\n}) => {\n  return children({\n    hideAll, displaying, views,\n    isActive: displaying.indexOf(id) !== -1,\n    show: (...args) => id ? show(id, ...args) : show(...args),\n    showOnlyMe: (...args) => hideAll() || show(id, ...args),\n    hide: (...args) => id ? hide(id, ...args) : hide(...args),\n  }, ...views[id].args);\n});"]}