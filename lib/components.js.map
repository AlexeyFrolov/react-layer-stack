{"version":3,"sources":["../src/components.js"],"names":["LayerStackMountPoint","namespace","store","dispatch","mountPointId","id","mountPointArgs","args","renderFn","views","displaying","show","hide","hideAll","length","map","index","view","showOnlyMe","hideMe","showMe","Error","Layer","createClass","componentWillMount","props","register","children","showInitially","defaultArgs","shouldComponentUpdate","newProps","use","needUpdate","toString","i","JSON","stringify","componentWillUnmount","render","LayerContext","isActive","indexOf"],"mappings":"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","file":"components.js","sourcesContent":["import React, { PropTypes } from 'react'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\n\nimport { ACTIONS } from './reducer'\n\nexport const LayerStackMountPoint = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({ id: mountPointId, args: mountPointArgs, renderFn, views, displaying, show, hide, hideAll}) => { // from store\n  return (\n    <div> { renderFn ? renderFn({views, displaying, show, hide, hideAll, mountPointId, mountPointArgs}) // it's possible to provide alternative renderFn for the MountPoint\n      : (displaying.length ? displaying.map ((id, index) => // if no alternative renderFn provided we'll use the default one\n          <div key={id}>\n            {(() => {\n              const view = views[id];\n              if (view && view.renderFn && view.mountPointId === mountPointId) {\n                return view.renderFn({ // TODO: check that renderFn is a function\n                  index, id, show, hide, hideAll, displaying, views, mountPointArgs, // seems like there is no valid use-case mountPointId in the Layer render function\n                  showOnlyMe: (...args) => hideAll() || show(id, ...args), // TODO: improve\n                  hideMe: () => hide(id), // intention here is to hide ID's management from Layer and let app developer manage these IDs independently\n                                          // which will give an ability to write general-purpose Layers and share them b/w projects\n                  showMe: (...args) => show(id, ...args) // sometimes you may want to change args of the current layer\n                }, ...view.args)\n              }\n              if (typeof view === 'undefined' || typeof view.renderFn === 'undefined') {\n                throw new Error(`\nIt seems like you're using LayerContext with id=\"${ id }\" but corresponding Layer isn't declared in the current Components tree.\nMake sure that Layer with id=\"${ id }\" is rendered into the current tree.\n`)\n              }})()}\n          </div>) : <noscript />)}\n    </div>\n  )\n});\n\nexport const Layer = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)((React.createClass({\n  componentWillMount() {\n    this.props.register(this.props.id, this.props.children, this.props.mountPointId);\n    if (this.props.showInitially) {\n      this.props.show(this.props.id, this.props.defaultArgs || [])\n    }\n  },\n  shouldComponentUpdate(newProps) {\n    const { use, children, register, id, mountPointId } = this.props;\n    let needUpdate = false;\n    if (id !== newProps.id || mountPointId !== newProps.mountPointId) {\n      needUpdate = true;\n    }\n    else if (children.toString() !== newProps.children.toString()) {\n      needUpdate = true;\n    }\n    else if (use) {\n      if (use.length !== newProps.use.length) {\n        needUpdate = true;\n      } else {\n        let i = use.length;\n        while (i--) {\n          if (JSON.stringify(use[i]) !== JSON.stringify(newProps.use[i])) {\n            needUpdate = true;\n          }\n        }\n      }\n    }\n\n    if (needUpdate) {\n      register(newProps.id, newProps.children, newProps.mountPointId);\n      return true;\n    }\n    return false;\n  },\n\n  componentWillUnmount() {\n    // TODO: garbage collection\n    // this.props.unregister(this.props.id)\n  },\n\n  render() {\n    return <noscript />\n  }\n})));\n\nexport const LayerContext = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({ children, id, // from props\n  displaying, show, hide, hideAll, views // from store\n}) => {\n  return children({\n    show, hide, hideAll, displaying, views,\n    isActive: displaying.indexOf(id) !== -1,\n    showMe: (...args) => show(id, ...args),\n    showOnlyMe: (...args) => hideAll() || show(id, ...args),\n    hideMe: () => hide(id),\n  });\n});"]}