{"version":3,"sources":["../src/components.js"],"names":["LayerStackMountPoint","namespace","store","dispatch","mountPointId","id","mountPointArgs","args","elementType","renderFn","views","displaying","show","hide","hideAll","length","map","index","key","view","showOnlyMe","Error","Layer","createClass","propTypes","use","array","componentWillMount","props","register","children","showInitially","initialArgs","setArgs","shouldComponentUpdate","newProps","needUpdate","toString","i","JSON","stringify","componentWillUnmount","render","LayerToggle","isActive","indexOf","for"],"mappings":"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","file":"components.js","sourcesContent":["import React, { PropTypes, createElement} from 'react'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\n\nimport { ACTIONS } from './reducer'\n\nexport const LayerStackMountPoint = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({\n  id: mountPointId, args: mountPointArgs, elementType = 'span', // from props\n  renderFn, views, displaying, show, hide, hideAll // from store\n}) => {\n  return createElement(elementType, {}, renderFn ? renderFn({views, displaying, show, hide, hideAll, mountPointId, mountPointArgs}) // it's possible to provide alternative renderFn for the MountPoint\n      : (displaying.length ? displaying.map ((id, index) => // if no alternative renderFn provided we'll use the default one\n        createElement(elementType, { key:id }, (() => {\n            const view = views[id];\n            if (view && view.renderFn && view.mountPointId === mountPointId) {\n              return view.renderFn({\n                index, id, hideAll, displaying, views, mountPointArgs, // seems like there is no valid use-case mountPointId in the Layer render function\n                showOnlyMe: (...args) => hideAll() || show(id, ...args), // TODO: think about improvement\n                hide: () => hide(id), // intention here is to hide ID's management from Layer and let app developer manage these IDs independently\n                // which will give an ability to write general-purpose Layers and share them b/w projects\n                show: (...args) => show(id, ...args) // sometimes you may want to change args of the current layer\n              }, ...view.args)\n            }\n            if (typeof view === 'undefined' || typeof view.renderFn === 'undefined') {\n              throw new Error(`\nIt seems like you're using LayerToggle with id=\"${ id }\" but corresponding Layer isn't declared in the current Components tree.\nMake sure that Layer with id=\"${ id }\" is rendered into the current tree.\n`)\n            }})())) : null))\n});\n\nexport const Layer = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)((React.createClass({\n  propTypes: {\n    use: PropTypes.array\n  },\n\n  componentWillMount() {\n    this.props.register(this.props.id, this.props.children, this.props.mountPointId);\n    if (this.props.showInitially) {\n      this.props.show(this.props.id, ...(this.props.initialArgs || []))\n    } else {\n      this.props.setArgs(this.props.id, ...(this.props.initialArgs || []))\n    }\n  },\n  shouldComponentUpdate(newProps) {\n    const { children, register, id, mountPointId, use } = this.props;\n    let needUpdate = false;\n    if (id !== newProps.id || mountPointId !== newProps.mountPointId) {\n      needUpdate = true;\n    }\n    else if (children.toString() !== newProps.children.toString()) {\n      needUpdate = true;\n    }\n    else if (use) {\n      if (use.length !== newProps.use.length) {\n        needUpdate = true;\n      } else {\n        let i = use.length;\n        while (i--) {\n          if (JSON.stringify(use[i]) !== JSON.stringify(newProps.use[i])) {\n            needUpdate = true;\n          }\n        }\n      }\n    }\n\n    if (needUpdate) {\n      register(newProps.id, newProps.children, newProps.mountPointId);\n      return true;\n    }\n    return false;\n  },\n\n  componentWillUnmount() {\n    // TODO: garbage collection\n    // this.props.unregister(this.props.id)\n  },\n\n  render() {\n    return null;\n  }\n})));\n\nexport const LayerToggle = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({\n  children, // from props\n  displaying, show, hide, hideAll, views, ...props, // from store\n}) => {\n  return children({\n    hideAll, displaying, views,\n    isActive: displaying.indexOf(props.for) !== -1,\n    show: (...args) => props.for ? show(props.for, ...args) : show(...args),\n    showOnlyMe: (...args) => hideAll() || show(props.for, ...args),\n    hide: (...args) => props.for ? hide(props.for, ...args) : hide(...args),\n  }, ...views[props.for].args);\n});"]}