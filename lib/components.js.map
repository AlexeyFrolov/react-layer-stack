{"version":3,"sources":["../src/components.js"],"names":["LayerStackMountPoint","namespace","store","dispatch","mountPointId","id","mountPointArgs","args","renderFn","views","displaying","show","hide","hideAll","length","map","index","view","showOnlyMe","hideMe","showMe","Error","Layer","createClass","componentWillMount","props","register","children","showInitially","initialArgs","setArgs","shouldComponentUpdate","newProps","use","needUpdate","toString","i","JSON","stringify","componentWillUnmount","render","LayerContext","isActive","indexOf"],"mappings":"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","file":"components.js","sourcesContent":["import React, { PropTypes } from 'react'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\n\nimport { ACTIONS } from './reducer'\n\nexport const LayerStackMountPoint = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({\n  id: mountPointId, args: mountPointArgs, // from props\n  renderFn, views, displaying, show, hide, hideAll // from store\n}) => {\n  return (\n    <div> { renderFn ? renderFn({views, displaying, show, hide, hideAll, mountPointId, mountPointArgs}) // it's possible to provide alternative renderFn for the MountPoint\n      : (displaying.length ? displaying.map ((id, index) => // if no alternative renderFn provided we'll use the default one\n        <div key={id}>\n          {(() => {\n            const view = views[id];\n            if (view && view.renderFn && view.mountPointId === mountPointId) {\n              return view.renderFn({\n                index, id, show, hide, hideAll, displaying, views, mountPointArgs, // seems like there is no valid use-case mountPointId in the Layer render function\n                showOnlyMe: (...args) => hideAll() || show(id, ...args), // TODO: think about improvement\n                hideMe: () => hide(id), // intention here is to hide ID's management from Layer and let app developer manage these IDs independently\n                                        // which will give an ability to write general-purpose Layers and share them b/w projects\n                showMe: (...args) => show(id, ...args) // sometimes you may want to change args of the current layer\n              }, ...view.args)\n            }\n            if (typeof view === 'undefined' || typeof view.renderFn === 'undefined') {\n              throw new Error(`\nIt seems like you're using LayerContext with id=\"${ id }\" but corresponding Layer isn't declared in the current Components tree.\nMake sure that Layer with id=\"${ id }\" is rendered into the current tree.\n`)\n            }})()}\n        </div>) : <noscript />)}\n    </div>\n  )\n});\n\nexport const Layer = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)((React.createClass({\n  componentWillMount() {\n    this.props.register(this.props.id, this.props.children, this.props.mountPointId);\n    if (this.props.showInitially) {\n      this.props.show(this.props.id, ...(this.props.initialArgs || []))\n    } else {\n      this.props.setArgs(this.props.id, ...(this.props.initialArgs || []))\n    }\n  },\n  shouldComponentUpdate(newProps) {\n    const { use, children, register, id, mountPointId } = this.props;\n    let needUpdate = false;\n    if (id !== newProps.id || mountPointId !== newProps.mountPointId) {\n      needUpdate = true;\n    }\n    else if (children.toString() !== newProps.children.toString()) {\n      needUpdate = true;\n    }\n    else if (use) {\n      if (use.length !== newProps.use.length) {\n        needUpdate = true;\n      } else {\n        let i = use.length;\n        while (i--) {\n          if (JSON.stringify(use[i]) !== JSON.stringify(newProps.use[i])) {\n            needUpdate = true;\n          }\n        }\n      }\n    }\n\n    if (needUpdate) {\n      register(newProps.id, newProps.children, newProps.mountPointId);\n      return true;\n    }\n    return false;\n  },\n\n  componentWillUnmount() {\n    // TODO: garbage collection\n    // this.props.unregister(this.props.id)\n  },\n\n  render() {\n    return <noscript />\n  }\n})));\n\nexport const LayerContext = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({\n  children, id, // from props\n  displaying, show, hide, hideAll, views // from store\n}) => {\n  return children({\n    show, hide, hideAll, displaying, views,\n    isActive: displaying.indexOf(id) !== -1,\n    showMe: (...args) => show(id, ...args),\n    showOnlyMe: (...args) => hideAll() || show(id, ...args),\n    hideMe: () => hide(id),\n  }, ...views[id].args);\n});"]}