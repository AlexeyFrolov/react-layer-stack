{"version":3,"sources":["../src/components.js"],"names":["LayerStackMountPoint","namespace","store","dispatch","renderFn","views","displaying","show","hide","hideAll","length","map","id","index","showOnlyMe","args","hideMe","showMe","Layer","createClass","componentWillMount","props","register","children","shouldComponentUpdate","newProps","use","needUpdate","toString","i","JSON","stringify","componentWillUnmount","render","LayerToggle","isActive","indexOf"],"mappings":"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","file":"components.js","sourcesContent":["import React, { PropTypes } from 'react'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\n\nimport { ACTIONS } from './reducer'\n\nexport const LayerStackMountPoint = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({ renderFn, views, displaying, show, hide, hideAll}) => { // from store\n  return (\n    <div> { renderFn ? renderFn({views, displaying, show, hide, hideAll})\n      : (displaying.length ? displaying.map (\n      (id, index) =>\n          <div key={id}>\n            {\n              views[id].renderFn({ // TODO: check that renderFn is a function\n                index, id, show, hide, hideAll, displaying, views,\n                showOnlyMe: (...args) => hideAll() || show(id, ...args), // TODO: improve\n                hideMe: () => hide(id),\n                showMe: (...args) => show(id, ...args) // sometimes you may want to change args of the current layer\n              }, ...views[id].args)\n            }\n          </div>\n    )\n      : <noscript />) }\n    </div>\n  )\n});\n\nexport const Layer = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)((React.createClass({\n  componentWillMount() {\n    this.props.register(this.props.id, this.props.children);\n  },\n  shouldComponentUpdate(newProps) {\n    const { use, children, register, id } = this.props;\n    let needUpdate = false;\n    if (id !== newProps.id) {\n      needUpdate = true;\n    }\n    else if (children.toString() !== newProps.children.toString()) {\n      needUpdate = true;\n    }\n    else if (use) {\n      if (use.length !== newProps.use.length) {\n        needUpdate = true;\n      } else {\n        let i = use.length;\n        while (i--) {\n          if (JSON.stringify(use[i]) !== JSON.stringify(newProps.use[i])) {\n            needUpdate = true;\n          }\n        }\n      }\n    }\n\n    if (needUpdate) {\n      register(newProps.id, newProps.children);\n      return true;\n    }\n    return false;\n  },\n\n  componentWillUnmount() {\n    // TODO: garbage collection\n    // this.props.unregister(this.props.id)\n  },\n\n  render() {\n    return <noscript />\n  }\n})));\n\nexport const LayerToggle = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({ children, id, // from props\n  displaying, show, hide, hideAll, views // from store\n}) => {\n  return children({\n    show, hide, hideAll, displaying, views,\n    isActive: displaying.indexOf(id) !== -1,\n    showMe: (...args) => show(id, ...args),\n    showOnlyMe: (...args) => hideAll() || show(id, ...args),\n    hideMe: () => hide(id),\n  });\n});"]}